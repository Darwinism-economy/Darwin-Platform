<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darwin Platform - Complete Token Launchpad (Direct Deploy) - TOKEN SYSTEM FIXED 2025-01-08 11:07:00</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-wallets@latest/lib/index.iife.min.js"></script>
    <script>
        // Embedded SPL Token functions - no external dependencies
        const SPL_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');
        
        // Add missing SPL Token instruction functions to solanaWeb3.Token namespace
        function createInitializeMintInstruction(programId, mint, decimals, mintAuthority, freezeAuthority) {
            const keys = [
                { pubkey: mint, isSigner: false, isWritable: true },
                { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false }
            ];
            
            const data = Buffer.alloc(82);
            data.writeUInt8(0, 0); // InitializeMint instruction
            data.writeUInt8(decimals, 1);
            data.write(mintAuthority.toBytes(), 2);
            data.write(freezeAuthority ? freezeAuthority.toBytes() : Buffer.alloc(32), 34);
            
            return new solanaWeb3.TransactionInstruction({
                keys,
                programId,
                data
            });
        }
        
        function createInitializeAccountInstruction(programId, account, mint, owner) {
            const keys = [
                { pubkey: account, isSigner: false, isWritable: true },
                { pubkey: mint, isSigner: false, isWritable: false },
                { pubkey: owner, isSigner: false, isWritable: false },
                { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false }
            ];
            
            const data = Buffer.alloc(1);
            data.writeUInt8(1, 0); // InitializeAccount instruction
            
            return new solanaWeb3.TransactionInstruction({
                keys,
                programId,
                data
            });
        }
        
        function createMintToInstruction(programId, mint, destination, authority, signers, amount) {
            const keys = [
                { pubkey: mint, isSigner: false, isWritable: true },
                { pubkey: destination, isSigner: false, isWritable: true },
                { pubkey: authority, isSigner: false, isWritable: false }
            ];
            
            if (signers && signers.length > 0) {
                signers.forEach(signer => {
                    keys.push({ pubkey: signer, isSigner: true, isWritable: false });
                });
            }
            
            const data = Buffer.alloc(9);
            data.writeUInt8(7, 0); // MintTo instruction
            data.writeBigUInt64LE(BigInt(amount), 1);
            
            return new solanaWeb3.TransactionInstruction({
                keys,
                programId,
                data
            });
        }

        // Add functions to solanaWeb3.Token namespace
        solanaWeb3.Token = {
            createInitializeMintInstruction,
            createInitializeAccountInstruction,
            createMintToInstruction
        };
    </script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .progress-bar { @apply w-full bg-gray-200 rounded-full h-2; }
        .progress-fill { @apply h-2 rounded-full transition-all duration-300; }
        .notification { @apply fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm; }
        .notification.success { @apply bg-green-500 text-white; }
        .notification.error { @apply bg-red-500 text-white; }
        .notification.info { @apply bg-blue-500 text-white; }
        .notification.warning { @apply bg-yellow-500 text-white; }
        .token-card { @apply bg-white rounded-xl p-6 shadow-sm border border-gray-200; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors; }
        .btn-secondary { @apply bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors; }
        .btn-success { @apply bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors; }
        .btn-warning { @apply bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors; }
        .btn-danger { @apply bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-gray-900">Darwin Platform</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <span id="network-status" class="px-2 py-1 bg-green-100 text-green-800 rounded-full">Testnet</span>
                    </div>
                    <button id="wallet-button" onclick="connectWallet()" class="btn-primary">
                        🔗 Connect Wallet
                    </button>
                    <div id="wallet-info" class="hidden text-sm text-gray-600">
                        <span id="wallet-balance">0 SOL</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Platform Overview -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Darwin Platform - Complete Token Launchpad</h2>
                <p class="text-gray-600 mb-6">Non-custodial, trustless, globally scalable token launchpad with automated treasury and distributor contracts.</p>
                
                <!-- Platform Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <div class="text-2xl font-bold text-blue-600" id="total-tokens">0</div>
                        <div class="text-gray-600">Tokens Launched</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <div class="text-2xl font-bold text-green-600" id="total-raised">0 SOL</div>
                        <div class="text-gray-600">Total Raised</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <div class="text-2xl font-bold text-purple-600" id="active-auctions">0</div>
                        <div class="text-gray-600">Active Auctions</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-sm">
                        <div class="text-2xl font-bold text-orange-600" id="total-users">0</div>
                        <div class="text-gray-600">Platform Users</div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Left Column: Token Creation & Management -->
                <div class="lg:col-span-1 space-y-6">
                    
                    <!-- Token Creation -->
                    <div class="token-card">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">🚀 Create New Token</h3>
                        
                        <form id="token-creation-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Token Name</label>
                                <input type="text" id="token-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="e.g., My Awesome Token" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Token Symbol</label>
                                <input type="text" id="token-symbol" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="e.g., MAT" maxlength="10" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Total Supply</label>
                                <input type="number" id="token-supply" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="1000000" min="1" max="1000000000" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Team Allocation (%)</label>
                                <input type="number" id="team-allocation" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="10" min="1" max="20" step="0.1" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Team Wallet Address</label>
                                <input type="text" id="team-wallet" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Enter team wallet address" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Minimum Bid (SOL)</label>
                                <input type="number" id="min-bid" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="1" min="0.1" step="0.1" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Auction Timer (blocks)</label>
                                <input type="number" id="auction-timer" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="216000" min="1000" required>
                            </div>
                            
                            <!-- Tax Configuration -->
                            <div class="border-t pt-4">
                                <h4 class="text-lg font-medium text-gray-900 mb-3">Tax Configuration</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Treasury Tax (%)</label>
                                        <input type="number" id="treasury-tax" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="3" min="0" max="10" step="0.1" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Distributor Tax (%)</label>
                                        <input type="number" id="distributor-tax" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="4" min="0" max="10" step="0.1" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Creator Tax (%)</label>
                                        <input type="number" id="creator-tax" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="2" min="0" max="10" step="0.1" required>
                                    </div>
                                    <div id="tax-validation" class="text-sm text-red-600 hidden">
                                        Total tax must equal 10%
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full btn-primary">
                                🚀 Deploy Token & Contracts
                            </button>
                        </form>
                    </div>
                    
                    <!-- Contract Status -->
                    <div class="token-card">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">📋 Contract Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Token Contract</span>
                                <span id="token-status" class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">Not Deployed</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Treasury Contract</span>
                                <span id="treasury-status" class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">Not Deployed</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Distributor Contract</span>
                                <span id="distributor-status" class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">Not Deployed</span>
                            </div>
                        </div>
                        
                        <div id="deployed-contracts" class="mt-4 space-y-2 hidden">
                            <h4 class="text-sm font-medium text-gray-900">Deployed Addresses:</h4>
                            <div class="text-xs space-y-1">
                                <div>Token: <span id="token-address" class="font-mono text-blue-600"></span></div>
                                <div>Treasury: <span id="treasury-address" class="font-mono text-green-600"></span></div>
                                <div>Distributor: <span id="distributor-address" class="font-mono text-purple-600"></span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Platform Token ($WIN) -->
                    <div class="token-card">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">🏆 Platform Token ($WIN)</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Total Supply</span>
                                <span class="font-medium">1,000,000 WIN</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Your Balance</span>
                                <span id="win-balance" class="font-medium">0 WIN</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Mint Address</span>
                                <span class="text-xs font-mono text-blue-600">So11111111111111111111111111111111111111112</span>
                            </div>
                        </div>
                        <button onclick="importWinToken()" class="w-full btn-secondary mt-4">
                            📋 Import $WIN to Wallet
                        </button>
                    </div>
                </div>
                
                <!-- Center Column: Fundraising & Auctions -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- Fundraising Section -->
                    <div class="token-card">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">💰 Active Fundraising</h3>
                            <span class="text-sm text-gray-500">200,000 blocks (~24 hours)</span>
                        </div>
                        
                        <div id="fundraising-container" class="space-y-4">
                            <!-- Fundraising cards will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Live Auctions Section -->
                    <div class="token-card">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">🏆 Live Auctions</h3>
                            <span class="text-sm text-gray-500">Last Man Standing</span>
                        </div>
                        
                        <div id="auctions-container" class="space-y-4">
                            <!-- Auction cards will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Treasury & Distributor Status -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="token-card">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">🏦 Treasury Status</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Total Locked</span>
                                    <span id="treasury-total" class="font-medium">0 SOL</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">LP Burned</span>
                                    <span id="treasury-lp" class="font-medium">0 SOL</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Creator Paid</span>
                                    <span id="treasury-creator" class="font-medium">0 SOL</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Available for Auction</span>
                                    <span id="treasury-auction" class="font-medium">0 SOL</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-card">
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">📊 Distributor Status</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Daily Tax Collected</span>
                                    <span id="distributor-daily" class="font-medium">0 SOL</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Next Distribution</span>
                                    <span id="distributor-next" class="font-medium">24h 00m</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Qualified Holders</span>
                                    <span id="distributor-holders" class="font-medium">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Min Holding Required</span>
                                    <span id="distributor-min" class="font-medium">1000 tokens</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Testnet Instructions -->
            <div class="mt-8">
                <div class="token-card bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">🔧 Testnet Setup Instructions</h3>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <h4 class="font-semibold text-blue-800 mb-2">📱 Phantom Wallet Setup:</h4>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                <li>Open Phantom wallet</li>
                                <li>Click the gear icon (Settings)</li>
                                <li>Go to "Change Network"</li>
                                <li>Select "Testnet"</li>
                                <li>Click "Connect Wallet" above</li>
                            </ol>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-2">💧 Get Test SOL:</h4>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                <li>Go to <a href="https://solfaucet.com" target="_blank" class="text-blue-600 hover:underline">solfaucet.com</a></li>
                                <li>Enter your wallet address</li>
                                <li>Click "Request SOL"</li>
                                <li>Wait 1-2 minutes for SOL to arrive</li>
                            </ol>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border border-purple-200">
                            <h4 class="font-semibold text-purple-800 mb-2">🎯 How to Test:</h4>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                <li>Create a new token using the form</li>
                                <li>Bid on live auctions (you'll get mock tokens)</li>
                                <li>Import token mint addresses to Phantom</li>
                                <li>Test all platform features</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testing & Development Tools -->
            <div class="mt-8">
                <div class="token-card">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">🧪 Testing & Development Tools</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-3">Time Controls</h4>
                            <div class="space-y-2">
                                <button onclick="accelerateTime(1)" class="w-full btn-secondary">⏱️ 1x Speed</button>
                                <button onclick="accelerateTime(5)" class="w-full btn-secondary">⚡ 5x Speed</button>
                                <button onclick="accelerateTime(10)" class="w-full btn-secondary">🚀 10x Speed</button>
                                <button onclick="skipToAuction()" class="w-full btn-warning">⏭️ Skip to Auction</button>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-3">Test Actions</h4>
                            <div class="space-y-2">
                                <button onclick="simulateBid()" class="w-full btn-success">💰 Simulate Bid</button>
                                <button onclick="simulateDistribution()" class="w-full btn-success">📊 Simulate Distribution</button>
                                <button onclick="resetPlatform()" class="w-full btn-danger">🔄 Reset Platform</button>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-3">Network Tools</h4>
                            <div class="space-y-2">
                                <button onclick="getTestSol()" class="w-full btn-primary">💧 Get Test SOL</button>
                                <button onclick="checkBalances()" class="w-full btn-secondary">💰 Check Balances</button>
                                <button onclick="exportData()" class="w-full btn-secondary">📤 Export Data</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script>
        // Global variables
        let wallet = null;
        let connection = null;
        let timeMultiplier = 1;
        let activeTokens = [];
        let deployedContracts = {};
        let platformStats = {
            totalTokens: 0,
            totalRaised: 0,
            activeAuctions: 0,
            totalUsers: 0
        };

        // Initialize platform
        document.addEventListener('DOMContentLoaded', function() {
            initializePlatform();
            loadSampleData();
            startTimeSimulation();
        });

        // Initialize platform
        function initializePlatform() {
            // Initialize Solana connection
            connection = new solanaWeb3.Connection(
                'https://api.testnet.solana.com',
                'confirmed'
            );
            
            // Load saved data
            loadPlatformData();
            
            // Update UI
            updatePlatformStats();
            updateContractStatus();
        }

        // Connect wallet
        async function connectWallet() {
            try {
                if (typeof window.solana !== 'undefined') {
                    wallet = window.solana;
                    
                    if (!wallet.isConnected) {
                        await wallet.connect();
                    }
                    
                    updateWalletUI();
                    showNotification('🔗 Wallet connected successfully!', 'success');
                } else {
                    showNotification('❌ Phantom wallet not found. Please install Phantom.', 'error');
                }
            } catch (error) {
                showNotification('❌ Failed to connect wallet: ' + error.message, 'error');
            }
        }

        // Update wallet UI
        async function updateWalletUI() {
            if (wallet && wallet.isConnected) {
                document.getElementById('wallet-button').classList.add('hidden');
                document.getElementById('wallet-info').classList.remove('hidden');
                
                // Get balance
                try {
                    const balance = await connection.getBalance(wallet.publicKey);
                    const balanceInSol = (balance / 1000000000).toFixed(4);
                    document.getElementById('wallet-balance').textContent = balanceInSol + ' SOL';
                } catch (error) {
                    console.error('Error getting balance:', error);
                }
            }
        }

        // Token creation form handler
        document.getElementById('token-creation-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!wallet || !wallet.isConnected) {
                showNotification('❌ Please connect your wallet first', 'error');
                return;
            }
            
            // Validate tax configuration
            const treasuryTax = parseFloat(document.getElementById('treasury-tax').value);
            const distributorTax = parseFloat(document.getElementById('distributor-tax').value);
            const creatorTax = parseFloat(document.getElementById('creator-tax').value);
            
            if (treasuryTax + distributorTax + creatorTax !== 10) {
                document.getElementById('tax-validation').classList.remove('hidden');
                showNotification('❌ Total tax must equal 10%', 'error');
                return;
            }
            
            document.getElementById('tax-validation').classList.add('hidden');
            
            // Create token
            await createToken();
        });

        // Create token and deploy contracts
        async function createToken() {
            try {
                if (!wallet || !wallet.isConnected) {
                    showNotification('❌ Please connect your wallet first', 'error');
                    return;
                }

                showNotification('🚀 Deploying token and contracts...', 'info');
                
                const tokenName = document.getElementById('token-name').value;
                const tokenSymbol = document.getElementById('token-symbol').value;
                const totalSupply = parseInt(document.getElementById('token-supply').value);
                const decimals = 9; // Standard for most tokens
                
                // Create the token mint
                const mint = solanaWeb3.Keypair.generate();
                const mintAuthority = wallet.publicKey;
                const freezeAuthority = wallet.publicKey;
                
                // Calculate rent exemption
                const mintRent = await connection.getMinimumBalanceForRentExemption(82);
                
                // Create transaction
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.createAccount({
                        fromPubkey: wallet.publicKey,
                        newAccountPubkey: mint.publicKey,
                        space: 82,
                        lamports: mintRent,
                        programId: SPL_TOKEN_PROGRAM_ID,
                    }),
                    solanaWeb3.Token.createInitializeMintInstruction(
                        SPL_TOKEN_PROGRAM_ID,
                        mint.publicKey,
                        decimals,
                        mintAuthority,
                        freezeAuthority
                    )
                );
                
                // Send transaction
                const signature = await wallet.sendTransaction(transaction, connection, { signers: [mint] });
                await connection.confirmTransaction(signature);
                
                // Create token account for the creator
                const tokenAccount = solanaWeb3.Keypair.generate();
                const accountRent = await connection.getMinimumBalanceForRentExemption(165);
                
                const createAccountTransaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.createAccount({
                        fromPubkey: wallet.publicKey,
                        newAccountPubkey: tokenAccount.publicKey,
                        space: 165,
                        lamports: accountRent,
                        programId: SPL_TOKEN_PROGRAM_ID,
                    }),
                    solanaWeb3.Token.createInitializeAccountInstruction(
                        SPL_TOKEN_PROGRAM_ID,
                        tokenAccount.publicKey,
                        mint.publicKey,
                        wallet.publicKey
                    ),
                    solanaWeb3.Token.createMintToInstruction(
                        SPL_TOKEN_PROGRAM_ID,
                        mint.publicKey,
                        tokenAccount.publicKey,
                        wallet.publicKey,
                        [],
                        totalSupply * Math.pow(10, decimals)
                    )
                );
                
                const accountSignature = await wallet.sendTransaction(createAccountTransaction, connection, { signers: [tokenAccount] });
                await connection.confirmTransaction(accountSignature);
                
                // Store deployed contracts
                deployedContracts = {
                    token: mint.publicKey.toString(),
                    treasury: generateMockAddress(), // Mock for now
                    distributor: generateMockAddress(), // Mock for now
                    name: tokenName,
                    symbol: tokenSymbol,
                    timestamp: Date.now()
                };
                
                // Save to localStorage
                localStorage.setItem('darwinDeployedContracts', JSON.stringify(deployedContracts));
                
                // Update UI
                updateContractStatus();
                addTokenToFundraising(tokenName, tokenSymbol);
                
                showNotification('✅ Token deployed successfully! Mint: ' + mint.publicKey.toString(), 'success');
                
                // Reset form
                document.getElementById('token-creation-form').reset();
                
            } catch (error) {
                console.error('Token creation error:', error);
                showNotification('❌ Failed to deploy: ' + error.message, 'error');
            }
        }

        // Generate mock address
        function generateMockAddress() {
            const chars = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let result = '';
            for (let i = 0; i < 44; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Update contract status
        function updateContractStatus() {
            if (deployedContracts.token) {
                document.getElementById('token-status').textContent = 'Deployed';
                document.getElementById('token-status').className = 'px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs';
                
                document.getElementById('treasury-status').textContent = 'Deployed';
                document.getElementById('treasury-status').className = 'px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs';
                
                document.getElementById('distributor-status').textContent = 'Deployed';
                document.getElementById('distributor-status').className = 'px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs';
                
                document.getElementById('deployed-contracts').classList.remove('hidden');
                document.getElementById('token-address').textContent = deployedContracts.token;
                document.getElementById('treasury-address').textContent = deployedContracts.treasury;
                document.getElementById('distributor-address').textContent = deployedContracts.distributor;
            }
        }

        // Add token to fundraising
        function addTokenToFundraising(name, symbol) {
            const container = document.getElementById('fundraising-container');
            
            const tokenCard = document.createElement('div');
            tokenCard.className = 'bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4';
            tokenCard.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold">${symbol.charAt(0)}</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">${name}</h4>
                            <p class="text-sm text-gray-500">$${symbol}</p>
                            <div class="mt-1">
                                <div class="flex items-center space-x-1">
                                    <span class="text-xs text-gray-400">Mint:</span>
                                    <span class="text-xs font-mono text-blue-600">${deployedContracts.token}</span>
                                    <button onclick="copyToClipboard('${deployedContracts.token}')" class="text-xs text-gray-500 hover:text-blue-600">📋</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Fundraising</span>
                </div>
                
                <div class="grid grid-cols-4 gap-4 text-sm mb-3">
                    <div>
                        <div class="text-gray-500">Raised SOL</div>
                        <div class="font-medium">0.0</div>
                    </div>
                    <div>
                        <div class="text-gray-500">Contributors</div>
                        <div class="font-medium">0</div>
                    </div>
                    <div>
                        <div class="text-gray-500">Progress</div>
                        <div class="font-medium">0%</div>
                    </div>
                    <div>
                        <div class="text-gray-500">Time Left</div>
                        <div class="font-medium text-red-600">24h 00m</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span>Fundraising Progress</span>
                        <span>0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-gradient-to-r from-blue-500 to-purple-600" style="width: 0%"></div>
                    </div>
                </div>
                
                <button onclick="contribute('${symbol.toLowerCase()}')" class="w-full btn-primary">
                    💰 Contribute SOL
                </button>
            `;
            
            container.appendChild(tokenCard);
            
            // Update stats
            platformStats.totalTokens++;
            updatePlatformStats();
        }

        // Contribute to fundraising
        async function contribute(symbol) {
            if (!wallet || !wallet.isConnected) {
                showNotification('❌ Please connect your wallet first', 'error');
                return;
            }
            
            const amount = prompt(`Enter SOL amount to contribute to ${symbol.toUpperCase()}:`);
            if (!amount || isNaN(amount) || amount <= 0) {
                showNotification('❌ Invalid amount', 'error');
                return;
            }
            
            try {
                showNotification(`💰 Contributing ${amount} SOL to ${symbol.toUpperCase()}...`, 'info');
                
                // Simulate contribution and token allocation
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Calculate tokens received (pro-rata distribution)
                const tokensReceived = Math.floor(amount * 10000); // 1 SOL = 10,000 tokens
                const mockTokenMint = generateMockAddress();
                
                showNotification(`✅ Successfully contributed ${amount} SOL to ${symbol.toUpperCase()}!`, 'success');
                
                // Show token allocation
                const tokenAllocation = `
🎉 CONTRIBUTION SUCCESSFUL!

You received ${tokensReceived.toLocaleString()} ${symbol.toUpperCase()} tokens!

To see them in Phantom:
1. Open Phantom wallet
2. Click "Import Token"
3. Paste this mint address: ${mockTokenMint}
4. Click "Import"

Token Mint: ${mockTokenMint}
                `;
                
                alert(tokenAllocation);
                
                // Copy mint address to clipboard
                copyToClipboard(mockTokenMint);
                
                // Update platform stats
                platformStats.totalRaised += parseFloat(amount);
                updatePlatformStats();
                
            } catch (error) {
                showNotification('❌ Contribution failed: ' + error.message, 'error');
            }
        }

        // Load sample data
        function loadSampleData() {
            // Add sample auction
            addSampleAuction('MEGA Protocol', 'MEGA', 2847.3, 1000, '2h 34m');
            addSampleAuction('Web3 Gaming', 'GAME', 1634.7, 750, '5h 12m');
            addSampleAuction('Metaverse Token', 'META', 3245.1, 1500, '12h 12m');
            
            platformStats.activeAuctions = 3;
            updatePlatformStats();
        }

        // Add sample auction
        function addSampleAuction(name, symbol, treasury, minBid, timeLeft) {
            const container = document.getElementById('auctions-container');
            
            const auctionCard = document.createElement('div');
            auctionCard.className = 'bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4';
            auctionCard.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-600 to-emerald-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold">${symbol.charAt(0)}</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">${name}</h4>
                            <p class="text-sm text-gray-500">$${symbol}</p>
                            <div class="mt-1">
                                <div class="flex items-center space-x-1">
                                    <span class="text-xs text-gray-400">Mint:</span>
                                    <span class="text-xs font-mono text-blue-600">${generateMockAddress()}</span>
                                    <button onclick="copyToClipboard('${generateMockAddress()}')" class="text-xs text-gray-500 hover:text-blue-600">📋</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">Auction</span>
                </div>
                
                <div class="mb-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg">
                    <div class="text-center">
                        <div class="text-lg font-bold text-purple-700 mb-1">Bid To Win Ratio</div>
                        <div class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">${((minBid / treasury) * 100).toFixed(3)}%</div>
                        <div class="text-xs text-purple-600 mt-1">Cost of min bid vs entire treasury</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-4 gap-4 text-sm mb-3">
                    <div>
                        <div class="text-gray-500">Treasury SOL</div>
                        <div class="font-medium">${treasury.toLocaleString()}</div>
                    </div>
                    <div>
                        <div class="text-gray-500">Minimum Bid</div>
                        <div class="font-medium text-center">${minBid} $${symbol}<br><span class="text-xs text-gray-500">($${(minBid * 0.2).toFixed(0)})</span></div>
                    </div>
                    <div>
                        <div class="text-gray-500">Time Alive</div>
                        <div class="font-medium text-blue-600">1h 26m</div>
                    </div>
                    <div>
                        <div class="text-gray-500">Time Left</div>
                        <div class="font-medium text-red-600">${timeLeft}</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span>Auction Timer</span>
                        <span>${timeLeft}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-gradient-to-r from-green-500 to-emerald-600" style="width: 65%"></div>
                    </div>
                </div>
                
                <div class="text-center mb-3">
                    <div class="text-sm text-gray-600">Min Holding: <span class="font-semibold text-green-600">${minBid} tokens</span></div>
                </div>
                
                <button onclick="placeBid('${symbol.toLowerCase()}')" class="w-full btn-success">
                    🏆 Place Bid
                </button>
            `;
            
            container.appendChild(auctionCard);
        }

        // Place bid
        async function placeBid(symbol) {
            if (!wallet || !wallet.isConnected) {
                showNotification('❌ Please connect your wallet first', 'error');
                return;
            }
            
            const amount = prompt(`Enter bid amount for ${symbol.toUpperCase()} auction:`);
            if (!amount || isNaN(amount) || amount <= 0) {
                showNotification('❌ Invalid bid amount', 'error');
                return;
            }
            
            try {
                showNotification(`🏆 Placing bid of ${amount} SOL...`, 'info');
                
                // Create a mock token for the user (in real implementation, this would be the actual token)
                const mockTokenMint = generateMockAddress();
                
                // Simulate successful bid and token transfer
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                showNotification(`✅ Bid successful! You received ${amount * 1000} ${symbol.toUpperCase()} tokens!`, 'success');
                
                // Show instructions for importing the token
                const importInstructions = `
🎉 BID SUCCESSFUL!

You received ${amount * 1000} ${symbol.toUpperCase()} tokens!

To see them in Phantom:
1. Open Phantom wallet
2. Click "Import Token"
3. Paste this mint address: ${mockTokenMint}
4. Click "Import"

Token Mint: ${mockTokenMint}
                `;
                
                alert(importInstructions);
                
                // Copy mint address to clipboard
                copyToClipboard(mockTokenMint);
                
            } catch (error) {
                showNotification('❌ Bid failed: ' + error.message, 'error');
            }
        }

        // Time acceleration
        function accelerateTime(multiplier) {
            timeMultiplier = multiplier;
            showNotification(`⏱️ Time accelerated to ${multiplier}x speed`, 'info');
        }

        // Skip to auction
        function skipToAuction() {
            showNotification('⏭️ Skipping to auction phase...', 'info');
        }

        // Simulate bid
        function simulateBid() {
            showNotification('💰 Simulating bid placement...', 'info');
        }

        // Simulate distribution
        function simulateDistribution() {
            showNotification('📊 Simulating daily distribution...', 'info');
        }

        // Reset platform
        function resetPlatform() {
            if (confirm('Are you sure you want to reset the platform? This will clear all data.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Get test SOL
        async function getTestSol() {
            if (!wallet || !wallet.isConnected) {
                showNotification('❌ Please connect your wallet first', 'error');
                return;
            }
            
            try {
                showNotification('💧 Requesting test SOL...', 'info');
                
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                showNotification('✅ Test SOL received! Check your wallet.', 'success');
                updateWalletUI();
                
            } catch (error) {
                showNotification('❌ Failed to get test SOL: ' + error.message, 'error');
            }
        }

        // Check balances
        async function checkBalances() {
            if (!wallet || !wallet.isConnected) {
                showNotification('❌ Please connect your wallet first', 'error');
                return;
            }
            
            try {
                const balance = await connection.getBalance(wallet.publicKey);
                const balanceInSol = (balance / 1000000000).toFixed(4);
                
                showNotification(`💰 Wallet Balance: ${balanceInSol} SOL`, 'info');
                
            } catch (error) {
                showNotification('❌ Failed to check balance: ' + error.message, 'error');
            }
        }

        // Export data
        function exportData() {
            const data = {
                deployedContracts,
                platformStats,
                activeTokens,
                timestamp: Date.now()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'darwin-platform-data.json';
            a.click();
            
            showNotification('📤 Data exported successfully!', 'success');
        }

        // Import WIN token
        function importWinToken() {
            const mintAddress = 'So11111111111111111111111111111111111111112';
            showNotification(`📋 WIN token mint address copied: ${mintAddress}`, 'success');
            copyToClipboard(mintAddress);
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('📋 Copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('❌ Failed to copy. Please copy manually.', 'error');
            });
        }

        // Update platform stats
        function updatePlatformStats() {
            document.getElementById('total-tokens').textContent = platformStats.totalTokens;
            document.getElementById('total-raised').textContent = platformStats.totalRaised.toFixed(1) + ' SOL';
            document.getElementById('active-auctions').textContent = platformStats.activeAuctions;
            document.getElementById('total-users').textContent = platformStats.totalUsers;
        }

        // Load platform data
        function loadPlatformData() {
            const savedContracts = localStorage.getItem('darwinDeployedContracts');
            if (savedContracts) {
                deployedContracts = JSON.parse(savedContracts);
                updateContractStatus();
            }
        }

        // Start time simulation
        function startTimeSimulation() {
            setInterval(() => {
                updateTimers();
            }, 1000 * timeMultiplier);
        }

        // Update timers
        function updateTimers() {
            // In real implementation, this would update all timers
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Tax validation
        document.getElementById('treasury-tax').addEventListener('input', validateTax);
        document.getElementById('distributor-tax').addEventListener('input', validateTax);
        document.getElementById('creator-tax').addEventListener('input', validateTax);

        function validateTax() {
            const treasuryTax = parseFloat(document.getElementById('treasury-tax').value) || 0;
            const distributorTax = parseFloat(document.getElementById('distributor-tax').value) || 0;
            const creatorTax = parseFloat(document.getElementById('creator-tax').value) || 0;
            
            const total = treasuryTax + distributorTax + creatorTax;
            const validationElement = document.getElementById('tax-validation');
            
            if (total > 10) {
                validationElement.textContent = `Total tax exceeds 10% (${total}%)`;
                validationElement.classList.remove('hidden');
            } else if (total < 10) {
                validationElement.textContent = `Total tax must equal 10% (currently ${total}%)`;
                validationElement.classList.remove('hidden');
            } else {
                validationElement.classList.add('hidden');
            }
        }
    </script>
</body>
</html> 